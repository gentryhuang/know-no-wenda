#parse("header.html")
<link rel="stylesheet" href="https://static-resourcess.oss-cn-hangzhou.aliyuncs.com/styles/index.css">
<link rel="stylesheet" href="https://static-resourcess.oss-cn-hangzhou.aliyuncs.com/styles/detail.css">
<div class="zg-wrap zu-main clearfix " role="main">
    <div class="zu-main-content">
        <div class="zu-main-content-inner">
            <div class="zg-section" id="zh-home-list-title">
                <i class="zg-icon zg-icon-feedlist"></i>最新动态
                <input type="hidden" id="is-topstory">
            </div>
            <div class="zu-main-feed-con navigable" data-feedtype="topstory" id="zh-question-list" data-widget="navigable"
                 data-navigable-options="{&quot;items&quot;:&quot;&gt; .zh-general-list .feed-content&quot;,&quot;offsetTop&quot;:-82}">
                <a href="javascript:;" class="zu-main-feed-fresh-button" id="zh-main-feed-fresh-button" style="display:none"></a>
                <div id="js-home-feed-list" class="zh-general-list topstory clearfix" data-init="{&quot;params&quot;: {}, &quot;nodename&quot;: &quot;TopStory2FeedList&quot;}"
                     data-delayed="true" data-za-module="TopStoryFeedList">

                    #foreach($vo in $vos)
                    <div class="feed-item folding feed-item-hook feed-item-2" feed-item-a="" data-type="a" id="feed-2" data-za-module="FeedItem" data-za-index="">
                        <meta itemprop="ZReactor" data-id="389034" data-meta="{&quot;source_type&quot;: &quot;promotion_answer&quot;, &quot;voteups&quot;: 4168, &quot;comments&quot;: 69, &quot;source&quot;: []}">
                        <div class="feed-item-inner">
                            <div class="avatar">
                                <a title="$!{vo.userDO.name}" data-tip="p$t$amuro1230" class="zm-item-link-avatar" target="_blank" href="/user/${vo.userDO.id}">
                                    <img src="$!{vo.userDO.headUrl}" class="zm-item-img-avatar">
                                </a>
                            </div>
                            <div class="feed-main">
                                <div class="feed-content" data-za-module="AnswerItem">
                                    <meta itemprop="answer-id" content="389034">
                                    <meta itemprop="answer-url-token" content="13174385">
                                    <h2 class="feed-title">
                                        <a class="question_link" target="_blank" href="/question/$!{vo.questionDO.id}">$!{vo.questionDO.title}</a>
                                    </h2>
                                    <div class="feed-question-detail-item">
                                        <div class="question-description-plain zm-editable-content"></div>
                                    </div>
                                    <div class="expandable entry-body">
                                        <div class="zm-item-vote">
                                            <a class="zm-item-vote-count js-expand js-vote-count" href="javascript:" data-bind-votecount="">${vo.followCount}</a></div>
                                        <div class="zm-item-answer-author-info">
                                            <a class="author-link" data-tip="p$b$amuro1230" target="_blank" href="/user/$!{vo.userDO.id}">
                                                $!{vo.userDO.name}
                                            </a>，$date.format('yyyy-MM-dd HH:mm:ss', $!{vo.questionDO.createDate})
                                        </div>
                                        <div class="zm-item-vote-info" data-votecount="4168" data-za-module="VoteInfo">
                                                <span class="voters text">
                                                    <a href="#" class="more text">
                                                        <span class="js-voteCount">4168</span>&nbsp;人赞同
                                                    </a>
                                                </span>
                                        </div>
                                        <div class="zm-item-rich-text expandable js-collapse-body" data-resourceid="123114" data-action="/answer/content"
                                             data-entry-url="/question/19857995/answer/13174385">
                                            <div class="zh-summary summary clearfix">${vo.questionDO.content}</div>
                                        </div>
                                    </div>
                                    <div class="feed-meta">
                                        <div class="zm-item-meta answer-actions clearfix js-contentActions">
                                            <div class="zm-meta-panel">
                                                <a data-follow="q:link" class="follow-link zg-follow meta-item" href="/question/$!{vo.questionDO.id}" id="sfb-123114">
                                                    <i class="z-icon-follow"></i>关注问题
                                                </a>
                                                <a href="/question/${vo.questionDO.id}" name="addcomment" class="meta-item toggle-comment js-toggleCommentBox">
                                                    <i class="z-icon-comment"></i>${vo.questionDO.commentCount} 条评论
                                                </a>
                                            <!-- 感谢 -->
                                                #if($curUser.id==$vo.userDO.id)
                                                #elseif($vo.questionDO.gratitudeFlag)
                                                <a class="meta-item js-thank" data-thanked="false">
                                                    <i class="z-icon-thank"></i><span style="cursor: pointer" class="question" gratitude-question="$vo.questionDO.id" questionUserId="$vo.userDO.id">取消感谢</span>
                                                </a>
                                                #else
                                                <a class="meta-item js-thank" data-thanked="false">
                                                    <i class="z-icon-thank"></i><span style="cursor: pointer" class="question" gratitude-question="$vo.questionDO.id" questionUserId="$vo.userDO.id">感谢</span>
                                                </a>
                                                #end
                                             <!-- 感谢 -->
                                                <button class="meta-item item-collapse js-collapse">
                                                    <i class="z-icon-fold"></i>收起
                                                </button>
                                            </div>
                                        </div>
                                        <!-- 是当前用户的应该显示删除x ,不是当前用户或则未登录就不显示-->
                                        #if($!curUser.id == $!vo.userDO.id)
                                        <a href="/delete_question/$!{vo.questionDO.id}" class="ignore zu-autohide" name="dislike" data-tip="s$b$不感兴趣"></a>
                                        #else
                                        #end
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    #end
                </div>
                #if($!count && $count>8 && $vos.size() < $count)
                <a href="/index?num=$!{num}" id="zh-load-more" data-method="next" class="zg-btn-white zg-r3px zu-button-more" style="">更多</a>
                #else
                #end
            </div>
        </div>
    </div>
</div>
#parse("common.html")
<script type="text/javascript" src="https://static-resourcess.oss-cn-hangzhou.aliyuncs.com/scripts/detail.js"></script>
<script>
    $(function () {
        $('.question').on('click', function (e) {
            // 获取已激活的标签页的名称
            var activeTab = $(e.target).text();
            var questionId = $(e.target).attr('gratitude-question');
            var questionUserId = $(e.target).attr('questionUserId');
            if(activeTab == '感谢'){
                console.log("感谢！");
                // 异步请求，发送ajax
                $.ajax({
                    url: "/add_questionId",
                    type: "GET",
                    data: {"questionId":questionId,"userId":questionUserId},
                    dataType:'json',
                    async:true,
                    success:function (data) {
                        if(data.code == 200){
                            // 修改标记
                            $(e.target).text('取消感谢');
                            return;
                        }
                        if(data.code == 300){
                            alert(data.result);
                            return;
                        }
                        if(data.code == 400){
                            alert(data.result);
                        }
                    },
                   error:function () {
                       alert("服务器处理异常");
                    }
                });
            }else if(activeTab == '取消感谢') {
                // 异步请求， 发送ajax(注意：静态资源都放到了cdn以及OSS网络不好的情况会有延迟)
                console.log("取消感谢！");
                $.ajax({
                    url: "/del_questionId",
                    type: "GET",
                    data: {"questionId":questionId,"userId":questionUserId},
                    dataType:'json',
                    async:true,
                    success:function (data) {
                        if(data.code == 200){
                            // 修改标记
                            $(e.target).text('感谢');
                            return;
                        }
                        if(data.code == 300){
                            alert(data.result);
                            return;
                        }
                        if(data.code == 400){
                            alert(data.result);
                        }
                    },
                    error:function () {
                        alert("服务器处理异常");
                    }
                });
            }
        });
    });
</script>
#parse("footer.html")